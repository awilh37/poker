<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WPS (second server)</title>

    <!-- 
      ============================================================
      =                 STYLESHEET LINK                         =
      ============================================================
      
      All styles have been moved to style.css and are
      linked here.
    -->
    <link rel="stylesheet" href="style.css?v=3.2.1"> <!-- v-up -->
</head>

<body>

    <!-- 
      ============================================================
      =                 NEW HEADER START                       =
      ============================================================
    -->
    <header class="main-header">
        <div class="header-left">
            <button id="hamburgerButton" class="header-icon-btn">
                <!-- Hamburger Menu Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
        </div>
        <div class="header-center">
            <h1 id="headerTitle" class="header-title" style="cursor: pointer;">WPS (second server)</h1>
        </div>
        <div class="header-right">
            <button id="accountButton" class="header-icon-btn">
                <!-- Account Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                </svg>
            </button>

            <!-- Account dropdown, hidden by default -->
            <div id="accountDropdown" class="dropdown-menu hidden">
                <!-- Links will be controlled by JS -->
                <a href="#" id="dropdownAccountLink">Manage Account</a>
                <a href="#" id="dropdownAdminLink" class="hidden">Admin Panel</a>
                <a href="#" id="dropdownLogoutLink">Logout</a>
            </div>
        </div>
    </header>

    <!-- Sidebar (for hamburger menu), hidden by default -->
    <nav id="sidebar" class="sidebar hidden">
        <a href="#" id="sidebarJoinGame">Join a Game</a>
        <a href="#" id="sidebarUserDirectory">User Directory</a>
        <!-- We can add more links here later -->
    </nav>
    <div id="sidebarOverlay" class="sidebar-overlay hidden"></div>
    <!-- =================== NEW HEADER END =================== -->


    <!-- 
      ============================================================
      =                NEW STANDINGS SIDEBAR START             =
      ============================================================
    -->
    <aside id="standingsSidebar" class="standings-sidebar">
        <h4 class="standings-title">Standings</h4>
        <ul id="standingsList" class="standings-list">
            <!-- User standings will be populated here by JS -->
            <li>
                <p>Loading...</p>
            </li>
        </ul>
    </aside>
    <!-- =================== NEW STANDINGS SIDEBAR END =================== -->


    <!-- 
      ============================================================
      =                 MAIN CONTAINER START                 =
      ============================================================
    -->
    <div id="mainContainer">

        <!-- Loading Indicator: Shown when app is initializing -->
        <div id="loadingIndicator" class="hidden loading-indicator">
            <svg class="animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
            </svg>
            <span>Loading, please wait...</span>
        </div>

        <!-- 
          ============================================================
          =                MESSAGE BOX (REMOVED)                     =
          ============================================================
        -->
        <!-- <div id="messageBox" class="message-box hidden"></div> -->
        <!-- This has been replaced by the notificationContainer at the end of <body> -->


        <!-- 
          ============================================================
          =                LOGIN PANEL (Hidden by default)           =
          ============================================================
        -->
        <div id="loginButtonsContainer" class="content-panel hidden">
            <h2>Welcome to WPS (second server)</h2>
            <p>Please sign in to continue.</p>
            <div class="form-actions">
                <button id="googleLoginButton" class="btn btn-google btn-full">
                    <svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M21.35,11.1H12.18V13.83H18.69C18.36,17.64 15.1,20.4 12.18,20.4C8.99,20.4 6.4,17.81 6.4,14.62C6.4,11.43 8.99,8.84 12.18,8.84C13.79,8.84 15.2,9.45 16.29,10.44L18.87,7.86C17.06,6.23 14.81,5.25 12.18,5.25C7.29,5.25 3.33,9.09 3.33,14.62C3.33,20.15 7.29,24 12.18,24C17.43,24 21.5,20.08 21.5,14.74C21.5,13.88 21.43,12.7 21.35,11.1V11.1Z">
                        </path>
                    </svg>
                    Sign in with Google
                </button>
            </div>
        </div>

        <!-- 
          ============================================================
          =       MAIN ACTIONS (NOW DASHBOARD) (Hidden by default)   =
          ============================================================
        -->
        <div id="mainActionButtons" class="content-panel hidden" style="max-width: 64rem; text-align: left;">
            <h2>Dashboard</h2>

            <!-- 
              These buttons are hidden but are "clicked" by the sidebar and
              dropdown menus. Do not remove them.
            -->
            <div class="hidden-action-buttons" style="display: none;">
                <button id="joinGameButton"></button>
                <button id="viewUserDirectoryButton"></button>
                <button id="openAccountManagementButton"></button>
                <button id="openAdminPanelButton"></button>
            </div>

            <div class="dashboard-layout">
                <!-- News Section -->
                <div id="newsSection" class="dashboard-card">
                    <div class="dashboard-card-header">
                        <h3>Latest News</h3>
                        <button id="editNewsButton" class="btn btn-icon btn-sm hidden" title="Edit News">
                            <!-- Pencil Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                stroke="currentColor" style="width: 1.25rem; height: 1.25rem;">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
                            </svg>
                        </button>
                    </div>
                    <div id="newsContent" class="dashboard-card-content news-content">
                        <!-- JS will populate this -->
                        <p>Loading news...</p>
                    </div>
                </div>

                <!-- Links Section -->
                <div id="linksSection" class="dashboard-card">
                    <div class="dashboard-card-header">
                        <h3>Quick Links</h3>
                        <button id="addLinkButton" class="btn btn-icon btn-sm hidden" title="Add New Link">
                            <!-- Plus Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                stroke="currentColor" style="width: 1.25rem; height: 1.25rem;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                            </svg>
                        </button>
                    </div>
                    <div id="linksContent" class="dashboard-card-content links-grid">
                        <!-- Links will be populated by JS -->
                        <p style="margin-top: 0;">Loading links...</p>
                    </div>
                </div>
            </div>

            <!-- Modals for editing (functionality not yet wired) -->
            <div id="editNewsModal" class="modal-overlay hidden">
                <div class="modal-content" style="max-width: 600px; text-align: left;">
                    <h3>Edit News</h3>
                    <div class="form-group">
                        <label for="newsMarkdownInput" class="form-label">News Content (use new lines for paragraphs)</label>
                        <textarea id="newsMarkdownInput" class="form-input" rows="10"
                            placeholder="Type news here..."></textarea>
                    </div>
                    <div class="form-actions" style="justify-content: flex-end;">
                        <button id="cancelEditNews" class="btn btn-gray">Cancel</button>
                        <button id="saveEditNews" class="btn btn-blue">Save News</button>
                    </div>
                </div>
            </div>
            <div id="editLinkModal" class="modal-overlay hidden">
                <div class="modal-content" style="max-width: 500px; text-align: left;">
                    <h3 id="linkLabel">Add New Link</h3>
                    <input type="hidden" id="editLinkId">
                    <div class="form-group">
                        <label for="linkTextInput" class="form-label">Button Text</label>
                        <input type="text" id="linkTextInput" class="form-input" placeholder="e.g., Google">
                    </div>
                    <div class="form-group">
                        <label for="linkUrlInput" class="form-label">Button URL</label>
                        <input type="url" id="linkUrlInput" class="form-input" placeholder="https://google.com">
                    </div>
                    <div class="form-group">
                        <label for="linkColorInput" class="form-label">Button Color</label>
                        <select id="linkColorInput" class="form-select">
                            <option value="btn-blue">Blue</option>
                            <option value="btn-green">Green</option>
                            <option value="btn-purple">Purple</option>
                            <option value="btn-red">Red</option>
                            <option value="btn-gray">Gray</option>
                        </select>
                    </div>
                    <div class="form-actions" style="justify-content: space-between;">
                        <button id="deleteLinkButton" class="btn btn-red hidden">Delete</button>
                        <div>
                            <button id="cancelEditLink" class="btn btn-gray">Cancel</button>
                            <button id="saveEditLink" class="btn btn-blue">Save Link</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 
          ============================================================
          =           ACCOUNT MANAGEMENT (Hidden by default)         =
          ============================================================
        -->
        <div id="accountManagementPanel" class="content-panel hidden">
            <button class="btn btn-gray" id="backToMenuFromAccount">← Back to Menu</button>
            <h2>Manage Account</h2>
            <div class="form-group">
                <label for="displayNameInput" class="form-label">Display Name</label>
                <input type="text" id="displayNameInput" class="form-input" placeholder="Enter your display name">
            </div>
            <button id="updateDisplayNameButton" class="btn btn-blue btn-full">Update Display Name</button>
        </div>

        <!-- 
          ============================================================
          =               ADMIN PANEL (Hidden by default)            =
          ============================================================
        -->
        <div id="adminPanel" class="content-panel hidden">
            <button class="btn btn-gray" id="backToMenuFromAdmin">← Back to Menu</button>
            <h2>Admin Panel</h2>
            <div class="form-actions" style="flex-direction: column;">
                <button id="openUserManagement" class="btn btn-blue btn-full">User Management</button>
                <button id="openGameRoomManagement" class="btn btn-green btn-full">Game Room Management</button>
                <button id="openCreateGroup" class="btn btn-purple btn-full">Create Chat Group</button>
                <button id="openInvestments" class="btn btn-gray btn-full">Investments (Disabled)</button>
            </div>
        </div>

        <!-- 
          ============================================================
          =            USER MANAGEMENT (Hidden by default)           =
          ============================================================
        -->
        <div id="userManagementPanel" class="content-panel hidden" style="max-width: 64rem;"> <!-- max-w-6xl -->
            <button class="btn btn-gray" id="backToAdminFromUser">← Back to Admin Panel</button>
            <h2>User Management</h2>
            <div style="overflow-x: auto;">
                <table id="userRolesTable" class="data-table">
                    <!-- JS will create table headers and rows -->
                </table>
            </div>
        </div>

        <!-- 
          ================================S============================
          =            GAME ROOM MGMT (Hidden by default)            =
          ============================================================
        -->
        <div id="gameRoomManagementPanel" class="content-panel hidden">
            <button class="btn btn-gray" id="backToAdminFromGame">← Back to Admin Panel</button>
            <h2>Game Room Management</h2>
            <div class="form-group">
                <label for="newRoomName" class="form-label">New Room Name</label>
                <input type="text" id="newRoomName" class="form-input" placeholder="e.g., 'Main Table'">
            </div>
            <button id="createGameRoomButton" class="btn btn-green btn-full">Create New Game Room</button>

            <h4 style="margin-top: 2rem;">Active Rooms</h4>
            <div id="gameRoomList" class="list-group">
                <!-- JS will populate this -->
            </div>
        </div>

        <!-- 
          ============================================================
          =           PLAYER JOIN ROOM (LOBBY) (Hidden)            =
          ============================================================
        -->
        <div id="playerJoinRoomPanel" class="content-panel hidden" style="max-width: 48rem;"> <!-- max-w-3xl -->
            <button class="btn btn-gray" id="backToMenuFromLobby">← Back to Menu</button>
            <h2>Available Game Rooms</h2>
            <div id="availableRoomsListContainer" class="list-group"
                style="max-height: 60vh; overflow-y: auto; padding-right: 0.5rem;">
                <!-- JS will populate this -->
                <p>Loading rooms...</p>
            </div>
        </div>

        <!-- 
          ============================================================
          =             GAME ROOM VIEW (Hidden by default)           =
          ============================================================
        -->
        <!-- 
            Game Room View Panel
            UPDATED: Removed max-width and internal styles.
            The new CSS will handle the styling.
        -->
        <div id="gameRoomViewPanel" class="content-panel hidden">
            <div class="game-room-header">
                <button class="btn btn-gray" id="leaveGameRoomButton">← Leave Room</button>
                <h2 id="gameRoomName">Game Room</h2>
                <div id="spectatorInfo" class="spectator-info">
                    <svg class="spectator-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639l4.43-7.584a1.012 1.012 0 011.012 0l4.43 7.584a1.012 1.012 0 010 .639l-4.43 7.583a1.012 1.012 0 01-1.012 0l-4.43-7.583z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12.002 14.33a2.345 2.345 0 100-4.69 2.345 2.345 0 000 4.69z" />
                    </svg>
                    <span id="spectatorCount">0</span>
                </div>
            </div>
            <!-- gameRoomContent is now the main container for the new UI -->
            <div id="gameRoomContent">
                <!-- JS will populate all game content here -->
            </div>
        </div>

        <!-- 
          ============================================================
          =             USER DIRECTORY (Hidden by default)           =
          ============================================================
        -->
        <div id="userDirectoryPanel" class="content-panel hidden" style="max-width: 64rem;"> <!-- max-w-6xl -->
            <button class="btn btn-gray" id="backToMenuFromDirectory">← Back to Menu</button>
            <h2>User Directory</h2>
            <div style="overflow-x: auto;">
                <table id="userDirectoryTable" class="data-table">
                    <!-- JS will create table headers and rows -->
                </table>
            </div>
        </div>

        <!-- 
          ============================================================
          =            CREATE GROUP (Hidden by default)              =
          ============================================================
        -->
        <div id="createGroupPanel" class="content-panel hidden">
            <button class="btn btn-gray" id="backToAdminFromGroup">← Back to Admin Panel</button>
            <h2>Create New Chat Group</h2>
            <div class="form-group">
                <label for="groupNameInput" class="form-label">Group Name</label>
                <input type="text" id="groupNameInput" class="form-input" placeholder="Enter group name">
            </div>
            <div class="form-group">
                <label class="form-label">Select Members</label>
                <div id="groupUserChecklist"
                    style="text-align: left; max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; border-radius: 8px;">
                    <!-- JS will populate this -->
                </div>
            </div>
            <button id="finalizeGroupButton" class="btn btn-green btn-full">Create Group</button>
        </div>

        <!-- 
          ============================================================
          =            GROUP CHAT MODAL (Hidden by default)          =
          ============================================================
        -->
        <div id="groupChatModal" class="modal-overlay hidden">
            <div class="modal-content" style="display: flex; flex-direction: column; max-width: 600px; height: 70vh;">
                <h3 id="groupChatTitle">Group Chat</h3>
                <div id="groupChatMessages"
                    style="flex-grow: 1; overflow-y: auto; border: 1px solid #eee; padding: 10px; margin: 10px 0; border-radius: 8px; text-align: left;">
                    <!-- Messages will be populated here -->
                </div>
                <div id="groupPlayerList" class="hidden"></div>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <input type="text" id="groupMessageInput" class="form-input" placeholder="Type a message...">
                    <button id="sendGroupMessageButton" class="btn btn-blue" style="width: auto;">Send</button>
                </div>
                <button id="closeGroupChatButton" class="btn btn-gray" style="margin-top: 1rem;">Close</button>
            </div>
        </div>
        <!-- =================== GROUP CHAT MODAL END =================== -->

        <!--
          ============================================================
          =            SPECTATOR LIST MODAL START (Hidden)           =
          ============================================================
        -->
        <div id="spectatorListModal" class="modal-overlay hidden">
            <div class="modal-content" style="max-width: 400px;">
                <h3>Spectators</h3>
                <div id="spectatorList" class="spectator-list">
                    <!-- JS will populate this -->
                    <p>No spectators yet.</p>
                </div>
                <button id="closeSpectatorListModalButton" class="btn btn-gray" style="margin-top: 1rem;">Close</button>
            </div>
        </div>
        <!-- =================== SPECTATOR LIST MODAL END =================== -->

        <!-- 
          ============================================================
          =                USER INFO MODAL START (Hidden)            =
          ============================================================
        -->
        <div id="userInfoModal" class="modal-overlay hidden">
            <div class="modal-content" id="userInfoModalContent">
                <!-- User info will be populated here by JS -->
                <h3>User Information</h3>
                <p>Loading...</p>
                <button id="closeUserInfoModalButton" class="btn btn-gray btn-half">Close</button>
            </div>
        </div>
        <!-- =================== USER INFO MODAL END =================== -->

        <!-- 
          ============================================================
          =            UPDATE CHIPS MODAL START (Hidden)             =
          ============================================================
        -->
        <div id="updateChipsModal" class="modal-overlay hidden">
            <div class="modal-content" id="updateChipsModalContent" style="max-width: 600px;">
                <h4>Update Player Chips (After Hand)</h4>
                <div id="updateChipsPlayerList" class="update-chips-list">
                    <!-- JS will populate this -->
                    <p>Loading players...</p>
                </div>
                <div class="update-chips-actions">
                    <button id="cancelChipUpdate" class="btn btn-gray btn-sm">Cancel</button>
                    <button id="submitChipUpdate" class="btn btn-green btn-sm">Submit & Reset</button>
                </div>
            </div>
        </div>
        <!-- =================== UPDATE CHIPS MODAL END =================== -->

        <!-- 
          ============================================================
          =             SET ORDER MODAL START (Hidden)               =
          ============================================================
        -->
        <div id="setOrderModal" class="modal-overlay hidden">
            <div class="modal-content" id="setOrderModalContent" style="max-width: 400px;">
                <h4>Set Player Order</h4>
                <p style="font-size: 0.9rem; color: #4b5563; margin-bottom: 1rem;">Drag and drop players to set the
                    turn order. The first player will be the dealer.</p>
                <div id="setOrderPlayerList" class="set-order-list">
                    <!-- JS will populate this -->
                    <p>Loading players...</p>
                </div>
                <div class="update-chips-actions">
                    <!-- Re-using update-chips-actions for styling -->
                    <button id="cancelSetOrder" class="btn btn-gray btn-sm">Cancel</button>
                    <button id="saveSetOrder" class="btn btn-green btn-sm">Save Order</button>
                </div>
            </div>
        </div>
        <!-- =================== SET ORDER MODAL END =================== -->

    </div> <!-- End of #mainContainer -->
    <!-- =================== MAIN CONTAINER END =================== -->

    <!-- 
      ============================================================
      =             NEW NOTIFICATION CONTAINER START             =
      ============================================================
    -->
    <!-- 
      This container will hold all the notification "toasts"
      that slide in from the top right.
    -->
    <div id="notificationContainer" class="notification-container">
        <!-- JS will populate this -->
    </div>
    <!-- =================== NEW NOTIFICATION CONTAINER END =================== -->


    <!-- 
      ============================================================
      =                 FIREBASE & APP SCRIPT LINK                =
      ============================================================
      
      All JavaScript has been moved to script.js and
      is linked here. It's a "module" to support
      Firebase imports.
    -->
    <script type="module" src="script.js?v=3.2.1"></script> <!-- v-up -->
</body>

</html>